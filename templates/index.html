<!DOCTYPE html>
<html>
  <head>
    <title>Adaptive Route Planner</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        #map {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1;
        }
        .side-panel {
            width: 200px;
            min-width: auto;
            height: 100%;
            position: absolute;
            top: 0;
            right: 0;
            background: #fff;
            padding: 10px;
            z-index: 1;
            opacity: 0.8;
            box-shadow: 2px 2px 10px #ccc;
            transition: all 0.5s ease;
        }
        .side-panel.collapsed {
            width: 0;
            padding: 0;
            box-shadow: none;
        }
        .collapse-button {
            position: absolute;
            right: 10px;
            bottom: 20px;
            background: rgb(143, 143, 143);
            border: none;
            padding: 10px;
            font-size: 20px;
            cursor: pointer;
            z-index: 2;
            opacity: .7;
        }
          
        .side-panel.collapsed .collapse-button {
            right: -40px;
          }
        .panel-content {
            position: fixed;
            display: block;
        }
        .side-panel.collapsed .panel-content {
            display: none;
        }
        
      </style>
      
      
    </head>
    <body style="overflow-y: hidden; overflow-x: hidden;">
        
        <div id="map"></div>
        <button class="collapse-button" onclick="togglePanel()">≡</button>

        <div class="side-panel">
            
            <form class="panel-content">
                <label for="start_point"><h3>Start Point: </h3></label>
                <input type="text" id="start_point" name="start_point">
                <select id="start_places"></select><br><br>
                <label for="end_point"><h3>End Point: </h3></label>
                <input type="text" id="end_point" name="end_point">
                <select id="end_places"></select><br><br>
                <input type="button" class="panel-content" value="Submit" onclick="getRoute()">
                <script>
                    document.addEventListener("DOMContentLoaded", function() {
                        document.getElementById("start_point").addEventListener("input", function() {
                            getPlaces(document.getElementById("start_point"));
                        });
                        document.getElementById("end_point").addEventListener("input", function() {
                            getPlaces(document.getElementById("end_point"));
                        });
                    });
                </script>
            </form>


            
          </div>

          

        <script>
        var map = L.map('map').setView([51.505, -0.09], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data © <a href="https://openstreetmap.org">OpenStreetMap</a> contributors',
            maxZoom: 18
        }).addTo(map);

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                document.getElementById("start_point").value = "Current position";
                var marker = L.marker([pos.lat, pos.lng]).addTo(map);
                map.setView(new L.LatLng(pos.lat, pos.lng), 13);
            }, function() {
                handleLocationError(true, infoWindow, map.getCenter());

                document.querySelector("form").addEventListener("submit", function(e) {
                e.preventDefault();
                // Get end point coordinates
                getPlaces(document.getElementById("end_point"), function(coords) {
                    var endMarker = L.marker([coords.lat, coords.lng]).addTo(map);
                    // Fit map bounds to both markers
                    map.fitBounds([[pos.lat, pos.lng], [coords.lat, coords.lng]]);
                });
            });

            });
        } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
        }

    
        </script>

        <script>
            function togglePanel() {
                var panel = document.querySelector(".side-panel");
                panel.classList.toggle("collapsed");
              }
          </script>
          <script src="D:\workspace\FYP\fyp_arp\OSM_API.js"></script>
    </body>
</html>